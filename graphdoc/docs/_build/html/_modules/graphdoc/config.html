<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>graphdoc.config &mdash; GraphDoc 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            GraphDoc
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">GraphDoc</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">graphdoc.config</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for graphdoc.config</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2025-, Semiotic AI, Inc.</span>
<span class="c1"># SPDX-License-Identifier: Apache-2.0</span>


<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="c1"># system packages</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Union</span>

<span class="c1"># external packages</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">dspy</span>

<span class="c1"># internal packages</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">graphdoc.data</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">DspyDataHelper</span><span class="p">,</span>
    <span class="n">GenerationDataHelper</span><span class="p">,</span>
    <span class="n">LocalDataHelper</span><span class="p">,</span>
    <span class="n">MlflowDataHelper</span><span class="p">,</span>
    <span class="n">QualityDataHelper</span><span class="p">,</span>
    <span class="n">load_yaml_config</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">graphdoc.eval</span><span class="w"> </span><span class="kn">import</span> <span class="n">DocGeneratorEvaluator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">graphdoc.modules</span><span class="w"> </span><span class="kn">import</span> <span class="n">DocGeneratorModule</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">graphdoc.prompts</span><span class="w"> </span><span class="kn">import</span> <span class="n">DocGeneratorPrompt</span><span class="p">,</span> <span class="n">PromptFactory</span><span class="p">,</span> <span class="n">SinglePrompt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">graphdoc.train</span><span class="w"> </span><span class="kn">import</span> <span class="n">SinglePromptTrainer</span><span class="p">,</span> <span class="n">TrainerFactory</span>

<span class="c1"># logging</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1">#######################</span>
<span class="c1"># Resource Setup      #</span>
<span class="c1">#######################</span>


<div class="viewcode-block" id="mlflow_data_helper_from_dict">
<a class="viewcode-back" href="../../source/graphdoc.html#graphdoc.mlflow_data_helper_from_dict">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">mlflow_data_helper_from_dict</span><span class="p">(</span><span class="n">mlflow_config</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MlflowDataHelper</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load a mlflow data helper from a dictionary of parameters.</span>

<span class="sd">    :param mlflow_config: Dictionary containing mlflow parameters.</span>
<span class="sd">    :type mlflow_config: dict</span>

<span class="sd">    .. code-block:: json</span>
<span class="sd">        {</span>
<span class="sd">            &quot;mlflow_tracking_uri&quot;: &quot;http://localhost:5000&quot;,</span>
<span class="sd">            &quot;mlflow_tracking_username&quot;: &quot;admin&quot;,</span>
<span class="sd">            &quot;mlflow_tracking_password&quot;: &quot;password&quot;</span>
<span class="sd">        }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">MlflowDataHelper</span><span class="p">(</span>
        <span class="n">mlflow_tracking_uri</span><span class="o">=</span><span class="n">mlflow_config</span><span class="p">[</span><span class="s2">&quot;mlflow_tracking_uri&quot;</span><span class="p">],</span>
        <span class="n">mlflow_tracking_username</span><span class="o">=</span><span class="n">mlflow_config</span><span class="p">[</span><span class="s2">&quot;mlflow_tracking_username&quot;</span><span class="p">],</span>
        <span class="n">mlflow_tracking_password</span><span class="o">=</span><span class="n">mlflow_config</span><span class="p">[</span><span class="s2">&quot;mlflow_tracking_password&quot;</span><span class="p">],</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="mlflow_data_helper_from_yaml">
<a class="viewcode-back" href="../../source/graphdoc.html#graphdoc.mlflow_data_helper_from_yaml">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">mlflow_data_helper_from_yaml</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">MlflowDataHelper</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load a mlflow data helper from a YAML file.</span>

<span class="sd">    :param yaml_path: Path to the YAML file.</span>
<span class="sd">    :type yaml_path: Union[str, Path]</span>

<span class="sd">    .. code-block:: yaml</span>
<span class="sd">        mlflow: </span>
<span class="sd">            mlflow_tracking_uri: !env MLFLOW_TRACKING_URI           # The tracking URI for MLflow</span>
<span class="sd">            mlflow_tracking_username: !env MLFLOW_TRACKING_USERNAME # The username for the mlflow tracking server</span>
<span class="sd">            mlflow_tracking_password: !env MLFLOW_TRACKING_PASSWORD # The password for the mlflow tracking server</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">load_yaml_config</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mlflow_data_helper_from_dict</span><span class="p">(</span>
        <span class="n">config</span><span class="p">[</span><span class="s2">&quot;mlflow&quot;</span><span class="p">],</span>
    <span class="p">)</span></div>



<span class="c1">#######################</span>
<span class="c1"># Data Methods        #</span>
<span class="c1">#######################</span>
<div class="viewcode-block" id="trainset_from_dict">
<a class="viewcode-back" href="../../source/graphdoc.html#graphdoc.trainset_from_dict">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">trainset_from_dict</span><span class="p">(</span><span class="n">trainset_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">dspy</span><span class="o">.</span><span class="n">Example</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load a trainset from a dictionary of parameters.</span>

<span class="sd">    .. code-block:: yaml</span>
<span class="sd">        {</span>
<span class="sd">            &quot;hf_api_key&quot;: !env HF_DATASET_KEY,          # Must be a valid Hugging</span>
<span class="sd">                                                        # Face API key</span>
<span class="sd">                                                        # (with permission to</span>
<span class="sd">                                                        # access graphdoc)</span>
<span class="sd">                                                        # TODO: we may make</span>
<span class="sd">                                                        # this public in the future</span>
<span class="sd">            &quot;load_from_hf&quot;: false,                      # Whether to load the dataset</span>
<span class="sd">                                                        # from Hugging Face</span>
<span class="sd">            &quot;load_from_local&quot;: true,                    # Whether to load the dataset</span>
<span class="sd">                                                        # from a local directory</span>
<span class="sd">            &quot;load_local_specific_category&quot;: false,      # Whether to load all categories</span>
<span class="sd">                                                        # or a specific category</span>
<span class="sd">            &quot;local_specific_category&quot;: perfect,         # The specific category</span>
<span class="sd">                                                        # (if load_from_local is true)</span>
<span class="sd">            &quot;local_parse_objects&quot;: true,                # Whether to parse the objects</span>
<span class="sd">                                                        # in the dataset</span>
<span class="sd">                                                        # (if load_from_local is true)</span>
<span class="sd">            &quot;split_for_eval&quot;: true,                     # Whether to split the dataset</span>
<span class="sd">                                                        # into trainset and evalset</span>
<span class="sd">            &quot;trainset_size&quot;: 1000,                      # The size of the trainset</span>
<span class="sd">            &quot;evalset_ratio&quot;: 0.1,                       # The proportionate size of evalset</span>
<span class="sd">            &quot;data_helper_type&quot;: &quot;quality&quot;               # Type of data helper to use</span>
<span class="sd">                                                        # (quality, generation)</span>
<span class="sd">        }</span>

<span class="sd">    :param trainset_dict: Dictionary containing trainset parameters.</span>
<span class="sd">    :type trainset_dict: dict</span>
<span class="sd">    :return: A trainset.</span>
<span class="sd">    :rtype: List[dspy.Example]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO: refactor to enable the passing of alternative schema_directory_path,</span>
    <span class="c1"># and the related enums that must be passed in turn</span>
    <span class="n">ldh</span> <span class="o">=</span> <span class="n">LocalDataHelper</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">trainset_dict</span><span class="p">[</span><span class="s2">&quot;data_helper_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;quality&quot;</span><span class="p">:</span>
        <span class="n">dh</span> <span class="o">=</span> <span class="n">QualityDataHelper</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">trainset_dict</span><span class="p">[</span><span class="s2">&quot;data_helper_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;generation&quot;</span><span class="p">:</span>
        <span class="n">dh</span> <span class="o">=</span> <span class="n">GenerationDataHelper</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Invalid data helper type: </span><span class="si">{</span><span class="n">trainset_dict</span><span class="p">[</span><span class="s1">&#39;data_helper_type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="c1"># TODO: refactor to be more ergonomic once we have more data sources implemented</span>
    <span class="k">if</span> <span class="n">trainset_dict</span><span class="p">[</span><span class="s2">&quot;load_from_hf&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;loading from Hugging Face is not implemented&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">trainset_dict</span><span class="p">[</span><span class="s2">&quot;load_from_local&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">trainset_dict</span><span class="p">[</span><span class="s2">&quot;load_local_specific_category&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;loading a specific category is not implemented&quot;</span><span class="p">)</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">ldh</span><span class="o">.</span><span class="n">folder_of_folders_to_dataset</span><span class="p">(</span>
            <span class="n">parse_objects</span><span class="o">=</span><span class="n">trainset_dict</span><span class="p">[</span><span class="s2">&quot;local_parse_objects&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">trainset</span> <span class="o">=</span> <span class="n">dh</span><span class="o">.</span><span class="n">trainset</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trainset_dict</span><span class="p">[</span><span class="s2">&quot;trainset_size&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">trainset_dict</span><span class="p">[</span><span class="s2">&quot;trainset_size&quot;</span><span class="p">],</span> <span class="nb">int</span>
        <span class="p">):</span>
            <span class="n">trainset</span> <span class="o">=</span> <span class="n">trainset</span><span class="p">[:</span> <span class="n">trainset_dict</span><span class="p">[</span><span class="s2">&quot;trainset_size&quot;</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">trainset</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Current implementation only supports loading from local directory&quot;</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="trainset_from_yaml">
<a class="viewcode-back" href="../../source/graphdoc.html#graphdoc.trainset_from_yaml">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">trainset_from_yaml</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">dspy</span><span class="o">.</span><span class="n">Example</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load a trainset from a YAML file.</span>

<span class="sd">    .. code-block:: yaml</span>
<span class="sd">        data:</span>
<span class="sd">            hf_api_key: !env HF_DATASET_KEY         # Must be a valid Hugging Face API key</span>
<span class="sd">                                                    # (with permission to access graphdoc)</span>
<span class="sd">                                                    # TODO: we may make this public</span>
<span class="sd">            load_from_hf: false                     # Load the dataset from Hugging Face</span>
<span class="sd">            load_from_local: true                   # Load the dataset from a local directory</span>
<span class="sd">            load_local_specific_category: false     # Load all categories or a specific category</span>
<span class="sd">                                                    # (if load_from_local is true)</span>
<span class="sd">            local_specific_category: perfect,       # Which category to load from the dataset</span>
<span class="sd">                                                    # (if load_from_local is true)</span>
<span class="sd">            local_parse_objects: true,              # Whether to parse the objects</span>
<span class="sd">                                                    # in the dataset</span>
<span class="sd">                                                    # (if load_from_local is true)</span>
<span class="sd">            split_for_eval: true,                   # Whether to split the dataset</span>
<span class="sd">                                                    # into trainset and evalset</span>
<span class="sd">            trainset_size: 1000,                    # The size of the trainset</span>
<span class="sd">            evalset_ratio: 0.1,                     # The proportionate size of evalset</span>
<span class="sd">            data_helper_type: quality               # Type of data helper to use</span>
<span class="sd">                                                    # (quality, generation)</span>

<span class="sd">    :param yaml_path: Path to the YAML file.</span>
<span class="sd">    :type yaml_path: Union[str, Path]</span>
<span class="sd">    :return: A trainset.</span>
<span class="sd">    :rtype: List[dspy.Example]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">load_yaml_config</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">)</span>
    <span class="n">trainset</span> <span class="o">=</span> <span class="n">trainset_from_dict</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">trainset</span></div>



<div class="viewcode-block" id="split_trainset">
<a class="viewcode-back" href="../../source/graphdoc.html#graphdoc.split_trainset">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">split_trainset</span><span class="p">(</span>
    <span class="n">trainset</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">dspy</span><span class="o">.</span><span class="n">Example</span><span class="p">],</span>
    <span class="n">evalset_ratio</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">42</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">dspy</span><span class="o">.</span><span class="n">Example</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">dspy</span><span class="o">.</span><span class="n">Example</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Split a trainset into a trainset and evalset.</span>

<span class="sd">    :param trainset: The trainset to split. :type trainset: List[dspy.Example]</span>
<span class="sd">    :param evalset_ratio: The proportionate size of the evalset. :type</span>
<span class="sd">    evalset_ratio: float :return: A tuple of trainset and evalset. :rtype:</span>
<span class="sd">    tuple[List[dspy.Example], List[dspy.Example]]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">split_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trainset</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">evalset_ratio</span><span class="p">))</span>
    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">trainset</span><span class="p">)</span>
    <span class="n">evalset</span> <span class="o">=</span> <span class="n">trainset</span><span class="p">[</span><span class="n">split_idx</span><span class="p">:]</span>
    <span class="n">trainset</span> <span class="o">=</span> <span class="n">trainset</span><span class="p">[:</span><span class="n">split_idx</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">trainset</span><span class="p">,</span> <span class="n">evalset</span></div>



<div class="viewcode-block" id="trainset_and_evalset_from_yaml">
<a class="viewcode-back" href="../../source/graphdoc.html#graphdoc.trainset_and_evalset_from_yaml">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">trainset_and_evalset_from_yaml</span><span class="p">(</span>
    <span class="n">yaml_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">dspy</span><span class="o">.</span><span class="n">Example</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">dspy</span><span class="o">.</span><span class="n">Example</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load a trainset and evalset from a YAML file.</span>

<span class="sd">    .. code-block:: yaml</span>
<span class="sd">        data:</span>
<span class="sd">            hf_api_key: !env HF_DATASET_KEY         # Must be a valid Hugging Face API key</span>
<span class="sd">                                                    # (with permission to access graphdoc)</span>
<span class="sd">                                                    # TODO: we may make this public</span>
<span class="sd">            load_from_hf: false                     # Load the dataset from Hugging Face</span>
<span class="sd">            load_from_local: true                   # Load the dataset from a local directory</span>
<span class="sd">            load_local_specific_category: false     # Load all categories or a specific category</span>
<span class="sd">                                                    # (if load_from_local is true)</span>
<span class="sd">            local_specific_category: perfect,       # Which category to load from the dataset</span>
<span class="sd">                                                    # (if load_from_local is true)</span>
<span class="sd">            local_parse_objects: true,              # Whether to parse the objects</span>
<span class="sd">                                                    # in the dataset</span>
<span class="sd">                                                    # (if load_from_local is true)</span>
<span class="sd">            split_for_eval: true,                   # Whether to split the dataset</span>
<span class="sd">                                                    # into trainset and evalset</span>
<span class="sd">            trainset_size: 1000,                    # The size of the trainset</span>
<span class="sd">            evalset_ratio: 0.1,                     # The proportionate size of evalset</span>
<span class="sd">            data_helper_type: quality               # Type of data helper to use</span>
<span class="sd">                                                    # (quality, generation)</span>
<span class="sd">            seed: 42                                # The seed for the random number generator</span>

<span class="sd">    :param yaml_path: Path to the YAML file.</span>
<span class="sd">    :type yaml_path: Union[str, Path]</span>
<span class="sd">    :return: A tuple of trainset and evalset.</span>
<span class="sd">    :rtype: tuple[List[dspy.Example], List[dspy.Example]]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">load_yaml_config</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">)</span>
    <span class="n">trainset</span> <span class="o">=</span> <span class="n">trainset_from_dict</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">split_trainset</span><span class="p">(</span>
        <span class="n">trainset</span><span class="p">,</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;evalset_ratio&quot;</span><span class="p">],</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;seed&quot;</span><span class="p">]</span>
    <span class="p">)</span></div>



<span class="c1">#######################</span>
<span class="c1"># Prompt Methods      #</span>
<span class="c1">#######################</span>
<div class="viewcode-block" id="single_prompt_from_dict">
<a class="viewcode-back" href="../../source/graphdoc.html#graphdoc.single_prompt_from_dict">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">single_prompt_from_dict</span><span class="p">(</span>
    <span class="n">prompt_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">prompt_metric</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">SinglePrompt</span><span class="p">],</span>
    <span class="n">mlflow_dict</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SinglePrompt</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load a single prompt from a dictionary of parameters.</span>

<span class="sd">    .. code-block:: json</span>
<span class="sd">        {</span>
<span class="sd">            &quot;prompt&quot;: &quot;doc_quality&quot;,             # Which prompt signature to use</span>
<span class="sd">            &quot;class&quot;: &quot;SchemaDocQualityPrompt&quot;,   # Must be a child of SinglePrompt</span>
<span class="sd">            &quot;type&quot;: &quot;predict&quot;,                   # The type of prompt to use</span>
<span class="sd">                                                    # (predict, chain_of_thought)</span>
<span class="sd">            &quot;metric&quot;: &quot;rating&quot;,                  # The type of metric to use</span>
<span class="sd">                                                    # (rating, category)</span>
<span class="sd">            &quot;load_from_mlflow&quot;: false,           # Whether to load the prompt from an MLFlow URI</span>
<span class="sd">            &quot;model_uri&quot;: null,                   # The tracking URI for MLflow</span>
<span class="sd">            &quot;model_name&quot;: null,                  # The name of the model in MLflow</span>
<span class="sd">            &quot;model_version&quot;: null                # The version of the model in MLflow</span>
<span class="sd">            &quot;prompt_metric&quot;: False               # Whether another prompt is used</span>
<span class="sd">                                                    # to calculate the metric</span>
<span class="sd">                                                    # (in which case we must also load that prompt)</span>
<span class="sd">        }</span>

<span class="sd">    :param prompt_dict: Dictionary containing prompt information.</span>
<span class="sd">    :type prompt_dict: dict</span>
<span class="sd">    :param prompt_metric: The metric to use to calculate the metric.</span>
<span class="sd">        Can be another prompt signature or a string.</span>
<span class="sd">    :type prompt_metric: Union[str, SinglePrompt]</span>
<span class="sd">    :return: A SinglePrompt object.</span>
<span class="sd">    :rtype: SinglePrompt</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># if we are loading from mlflow, modify the prompt_dict with the loaded model</span>
        <span class="k">if</span> <span class="n">prompt_dict</span><span class="p">[</span><span class="s2">&quot;load_from_mlflow&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">mlflow_dict</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading prompt from MLflow: </span><span class="si">{</span><span class="n">prompt_dict</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">mdh</span> <span class="o">=</span> <span class="n">mlflow_data_helper_from_dict</span><span class="p">(</span><span class="n">mlflow_dict</span><span class="p">)</span>
                <span class="n">prompt</span> <span class="o">=</span> <span class="n">mdh</span><span class="o">.</span><span class="n">model_by_args</span><span class="p">(</span><span class="n">prompt_dict</span><span class="p">)</span>
                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prompt loaded from MLflow: </span><span class="si">{</span><span class="n">prompt</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">prompt_signature</span> <span class="o">=</span> <span class="n">DspyDataHelper</span><span class="o">.</span><span class="n">prompt_signature</span><span class="p">(</span><span class="n">prompt</span><span class="p">)</span>
                <span class="n">prompt_dict</span><span class="p">[</span><span class="s2">&quot;prompt&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prompt_signature</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;MLflow tracking dict not provided&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">PromptFactory</span><span class="o">.</span><span class="n">single_prompt</span><span class="p">(</span>
            <span class="n">prompt</span><span class="o">=</span><span class="n">prompt_dict</span><span class="p">[</span><span class="s2">&quot;prompt&quot;</span><span class="p">],</span>
            <span class="n">prompt_class</span><span class="o">=</span><span class="n">prompt_dict</span><span class="p">[</span><span class="s2">&quot;class&quot;</span><span class="p">],</span>
            <span class="n">prompt_type</span><span class="o">=</span><span class="n">prompt_dict</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
            <span class="n">prompt_metric</span><span class="o">=</span><span class="n">prompt_metric</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error creating single prompt: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span></div>



<div class="viewcode-block" id="single_prompt_from_yaml">
<a class="viewcode-back" href="../../source/graphdoc.html#graphdoc.single_prompt_from_yaml">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">single_prompt_from_yaml</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">SinglePrompt</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load a single prompt from a YAML file.</span>

<span class="sd">    .. code-block:: yaml</span>
<span class="sd">        prompt:</span>
<span class="sd">            prompt: base_doc_gen        # Which prompt signature to use</span>
<span class="sd">            class: DocGeneratorPrompt   # Must be a child of SinglePrompt</span>
<span class="sd">                                        # (we will use an enum to map this)</span>
<span class="sd">            type: chain_of_thought      # The type of prompt to use</span>
<span class="sd">                                        # (predict, chain_of_thought)</span>
<span class="sd">            metric: rating              # The type of metric to use</span>
<span class="sd">                                        # (rating, category)</span>
<span class="sd">            load_from_mlflow: false     # Whether to load the prompt</span>
<span class="sd">                                        # from an MLFlow URI</span>
<span class="sd">            model_uri: null             # The tracking URI for MLflow</span>
<span class="sd">            model_name: null            # The name of the model in MLflow</span>
<span class="sd">            model_version: null         # The version of the model in MLflow</span>
<span class="sd">            prompt_metric: true         # Whether another prompt is used</span>
<span class="sd">                                        # to calculate the metric</span>
<span class="sd">                                        # (in which case we must also load that prompt)</span>

<span class="sd">        prompt_metric:</span>
<span class="sd">            prompt: doc_quality         # The prompt to use to calculate</span>
<span class="sd">                                        # the metric</span>
<span class="sd">            class: DocQualityPrompt     # The class of the prompt to use</span>
<span class="sd">                                        # to calculate the metric</span>
<span class="sd">            type: predict               # The type of prompt to use</span>
<span class="sd">                                        # to calculate the metric</span>
<span class="sd">            metric: rating              # The metric to use to calculate</span>
<span class="sd">                                        # the metric</span>
<span class="sd">            load_from_mlflow: false     # Whether to load the prompt</span>
<span class="sd">                                        # from an MLFlow URI</span>

<span class="sd">    :param yaml_path: Path to the YAML file.</span>
<span class="sd">    :type yaml_path: str</span>
<span class="sd">    :return: A SinglePrompt object.</span>
<span class="sd">    :rtype: SinglePrompt</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">load_yaml_config</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">)</span>
    <span class="n">mlflow_config</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mlflow&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;prompt&quot;</span><span class="p">][</span><span class="s2">&quot;prompt_metric&quot;</span><span class="p">]:</span>
        <span class="n">prompt_metric_config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;prompt_metric&quot;</span><span class="p">]</span>
        <span class="n">prompt_metric_metric</span> <span class="o">=</span> <span class="n">prompt_metric_config</span><span class="p">[</span><span class="s2">&quot;metric&quot;</span><span class="p">]</span>
        <span class="n">prompt_metric</span> <span class="o">=</span> <span class="n">single_prompt_from_dict</span><span class="p">(</span>
            <span class="n">prompt_metric_config</span><span class="p">,</span> <span class="n">prompt_metric_metric</span><span class="p">,</span> <span class="n">mlflow_config</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">prompt_metric</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;prompt&quot;</span><span class="p">][</span><span class="s2">&quot;metric&quot;</span><span class="p">]</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="n">single_prompt_from_dict</span><span class="p">(</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;prompt&quot;</span><span class="p">],</span> <span class="n">prompt_metric</span><span class="p">,</span> <span class="n">mlflow_config</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">prompt</span></div>



<span class="c1">#######################</span>
<span class="c1"># Trainer Methods     #</span>
<span class="c1">#######################</span>
<div class="viewcode-block" id="single_trainer_from_dict">
<a class="viewcode-back" href="../../source/graphdoc.html#graphdoc.single_trainer_from_dict">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">single_trainer_from_dict</span><span class="p">(</span>
    <span class="n">trainer_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">prompt</span><span class="p">:</span> <span class="n">SinglePrompt</span><span class="p">,</span>
    <span class="n">trainset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">dspy</span><span class="o">.</span><span class="n">Example</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">evalset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">dspy</span><span class="o">.</span><span class="n">Example</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SinglePromptTrainer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load a single trainer from a dictionary of parameters.</span>

<span class="sd">    .. code-block:: json</span>
<span class="sd">        {</span>
<span class="sd">            &quot;trainer&quot;: {</span>
<span class="sd">                &quot;class&quot;: &quot;DocQualityTrainer&quot;,</span>
<span class="sd">                &quot;mlflow_model_name&quot;: &quot;doc_quality_model&quot;,</span>
<span class="sd">                &quot;mlflow_experiment_name&quot;: &quot;doc_quality_experiment&quot;,</span>
<span class="sd">                &quot;mlflow_tracking_uri&quot;: &quot;http://localhost:5000&quot;</span>
<span class="sd">            },</span>
<span class="sd">            &quot;optimizer&quot;: {</span>
<span class="sd">                &quot;optimizer_type&quot;: &quot;miprov2&quot;,</span>
<span class="sd">                &quot;auto&quot;: &quot;light&quot;,</span>
<span class="sd">                &quot;max_labeled_demos&quot;: 2,</span>
<span class="sd">                &quot;max_bootstrapped_demos&quot;: 4,</span>
<span class="sd">                &quot;num_trials&quot;: 2,</span>
<span class="sd">                &quot;minibatch&quot;: true</span>
<span class="sd">            },</span>
<span class="sd">        }</span>

<span class="sd">    :param trainer_dict: Dictionary containing trainer parameters.</span>
<span class="sd">    :type trainer_dict: dict</span>
<span class="sd">    :param prompt: The prompt to use for this trainer.</span>
<span class="sd">    :type prompt: SinglePrompt</span>
<span class="sd">    :return: A SinglePromptTrainer object.</span>
<span class="sd">    :rtype: SinglePromptTrainer</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">trainset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">trainset</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">evalset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">evalset</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">TrainerFactory</span><span class="o">.</span><span class="n">single_trainer</span><span class="p">(</span>
            <span class="n">trainer_class</span><span class="o">=</span><span class="n">trainer_dict</span><span class="p">[</span><span class="s2">&quot;trainer&quot;</span><span class="p">][</span><span class="s2">&quot;class&quot;</span><span class="p">],</span>
            <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span>
            <span class="n">optimizer_type</span><span class="o">=</span><span class="n">trainer_dict</span><span class="p">[</span><span class="s2">&quot;optimizer&quot;</span><span class="p">][</span><span class="s2">&quot;optimizer_type&quot;</span><span class="p">],</span>
            <span class="n">optimizer_kwargs</span><span class="o">=</span><span class="n">trainer_dict</span><span class="p">[</span><span class="s2">&quot;optimizer&quot;</span><span class="p">],</span>
            <span class="n">mlflow_model_name</span><span class="o">=</span><span class="n">trainer_dict</span><span class="p">[</span><span class="s2">&quot;trainer&quot;</span><span class="p">][</span><span class="s2">&quot;mlflow_model_name&quot;</span><span class="p">],</span>
            <span class="n">mlflow_experiment_name</span><span class="o">=</span><span class="n">trainer_dict</span><span class="p">[</span><span class="s2">&quot;trainer&quot;</span><span class="p">][</span><span class="s2">&quot;mlflow_experiment_name&quot;</span><span class="p">],</span>
            <span class="n">mlflow_tracking_uri</span><span class="o">=</span><span class="n">trainer_dict</span><span class="p">[</span><span class="s2">&quot;trainer&quot;</span><span class="p">][</span><span class="s2">&quot;mlflow_tracking_uri&quot;</span><span class="p">],</span>
            <span class="n">trainset</span><span class="o">=</span><span class="n">trainset</span><span class="p">,</span>
            <span class="n">evalset</span><span class="o">=</span><span class="n">evalset</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error creating single trainer: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span></div>



<div class="viewcode-block" id="single_trainer_from_yaml">
<a class="viewcode-back" href="../../source/graphdoc.html#graphdoc.single_trainer_from_yaml">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">single_trainer_from_yaml</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">SinglePromptTrainer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load a single prompt trainer from a YAML file.</span>

<span class="sd">    .. code-block:: yaml</span>
<span class="sd">        trainer:</span>
<span class="sd">            hf_api_key: !env HF_DATASET_KEY         # Must be a valid Hugging Face API key</span>
<span class="sd">                                                    # (with permission to access graphdoc)</span>
<span class="sd">                                                    # TODO: we may make this public</span>
<span class="sd">            load_from_hf: false                     # Load the dataset from Hugging Face</span>
<span class="sd">            load_from_local: true                   # Load the dataset from a local directory</span>
<span class="sd">            load_local_specific_category: false     # Load all categories or a specific category</span>
<span class="sd">                                                    # (if load_from_local is true)</span>
<span class="sd">            local_specific_category: perfect,       # Which category to load from the dataset</span>
<span class="sd">                                                    # (if load_from_local is true)</span>
<span class="sd">            local_parse_objects: true,              # Whether to parse the objects</span>
<span class="sd">                                                    # in the dataset</span>
<span class="sd">                                                    # (if load_from_local is true)</span>
<span class="sd">            split_for_eval: true,                   # Whether to split the dataset</span>
<span class="sd">                                                    # into trainset and evalset</span>
<span class="sd">            trainset_size: 1000,                    # The size of the trainset</span>
<span class="sd">            evalset_ratio: 0.1,                     # The proportionate size of evalset</span>

<span class="sd">        prompt:</span>
<span class="sd">            prompt: base_doc_gen                    # Which prompt signature to use</span>
<span class="sd">            class: DocGeneratorPrompt               # Must be a child of SinglePrompt</span>
<span class="sd">                                                    # (we will use an enum to map this)</span>
<span class="sd">            type: chain_of_thought                  # The type of prompt to use</span>
<span class="sd">                                                    # (predict, chain_of_thought)</span>
<span class="sd">            metric: rating                          # The type of metric to use</span>
<span class="sd">                                                    # (rating, category)</span>
<span class="sd">            load_from_mlflow: false                 # L oad the prompt from an MLFlow URI</span>
<span class="sd">            model_uri: null                         # The tracking URI for MLflow</span>
<span class="sd">            model_name: null                        # The name of the model in MLflow</span>
<span class="sd">            model_version: null                     # The version of the model in MLflow</span>
<span class="sd">            prompt_metric: true                     # Whether another prompt is used</span>
<span class="sd">                                                    # to calculate the metric</span>
<span class="sd">                                                    # (in which case we must load prompt)</span>

<span class="sd">        prompt_metric:</span>
<span class="sd">            prompt: doc_quality                     # The prompt to use to calculate the metric</span>
<span class="sd">            class: DocQualityPrompt                 # The class of the prompt to use</span>
<span class="sd">                                                    # to calculate the metric</span>
<span class="sd">            type: predict                           # The type of prompt to use</span>
<span class="sd">                                                    # to calculate the metric</span>
<span class="sd">            metric: rating                          # The metric to use to calculate</span>
<span class="sd">                                                    # the metric</span>
<span class="sd">            load_from_mlflow: false                 # Whether to load the prompt</span>
<span class="sd">                                                    # from an MLFlow URI</span>
<span class="sd">            model_uri: null                         # The tracking URI for MLflow</span>
<span class="sd">            model_name: null                        # The name of the model in MLflow</span>
<span class="sd">            model_version: null                     # The version of the model in MLflow</span>

<span class="sd">    :param yaml_path: Path to the YAML file.</span>
<span class="sd">    :type yaml_path: Union[str, Path]</span>
<span class="sd">    :return: A SinglePromptTrainer object.</span>
<span class="sd">    :rtype: SinglePromptTrainer</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">load_yaml_config</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">)</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="n">single_prompt_from_yaml</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">)</span>
        <span class="n">trainset</span><span class="p">,</span> <span class="n">evalset</span> <span class="o">=</span> <span class="n">trainset_and_evalset_from_yaml</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">single_trainer_from_dict</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">prompt</span><span class="p">,</span> <span class="n">trainset</span><span class="p">,</span> <span class="n">evalset</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error creating trainer from YAML: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span></div>



<span class="c1">#######################</span>
<span class="c1"># Module Methods      #</span>
<span class="c1">#######################</span>
<div class="viewcode-block" id="doc_generator_module_from_dict">
<a class="viewcode-back" href="../../source/graphdoc.html#graphdoc.doc_generator_module_from_dict">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">doc_generator_module_from_dict</span><span class="p">(</span>
    <span class="n">module_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">DocGeneratorPrompt</span><span class="p">,</span> <span class="n">SinglePrompt</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DocGeneratorModule</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load a doc generator module from a dictionary of parameters.</span>

<span class="sd">    .. code-block:: json</span>
<span class="sd">        {</span>
<span class="sd">            &quot;retry&quot;: true,</span>
<span class="sd">            &quot;retry_limit&quot;: 1,</span>
<span class="sd">            &quot;rating_threshold&quot;: 3,</span>
<span class="sd">            &quot;fill_empty_descriptions&quot;: true</span>
<span class="sd">        }</span>

<span class="sd">    :param module_dict: Dictionary containing module parameters.</span>
<span class="sd">    :type module_dict: dict</span>
<span class="sd">    :param prompt: The prompt to use for this module.</span>
<span class="sd">    :type prompt: DocGeneratorPrompt</span>
<span class="sd">    :return: A DocGeneratorModule object.</span>
<span class="sd">    :rtype: DocGeneratorModule</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">DocGeneratorModule</span><span class="p">(</span>
        <span class="n">prompt</span><span class="o">=</span><span class="n">prompt</span><span class="p">,</span>
        <span class="n">retry</span><span class="o">=</span><span class="n">module_dict</span><span class="p">[</span><span class="s2">&quot;retry&quot;</span><span class="p">],</span>
        <span class="n">retry_limit</span><span class="o">=</span><span class="n">module_dict</span><span class="p">[</span><span class="s2">&quot;retry_limit&quot;</span><span class="p">],</span>
        <span class="n">rating_threshold</span><span class="o">=</span><span class="n">module_dict</span><span class="p">[</span><span class="s2">&quot;rating_threshold&quot;</span><span class="p">],</span>
        <span class="n">fill_empty_descriptions</span><span class="o">=</span><span class="n">module_dict</span><span class="p">[</span><span class="s2">&quot;fill_empty_descriptions&quot;</span><span class="p">],</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="doc_generator_module_from_yaml">
<a class="viewcode-back" href="../../source/graphdoc.html#graphdoc.doc_generator_module_from_yaml">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">doc_generator_module_from_yaml</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">DocGeneratorModule</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load a doc generator module from a YAML file.</span>

<span class="sd">    .. code-block:: yaml</span>
<span class="sd">        prompt:</span>
<span class="sd">            prompt: base_doc_gen            # Which prompt signature to use</span>
<span class="sd">            class: DocGeneratorPrompt       # Must be a child of SinglePrompt</span>
<span class="sd">                                            # (we will use an enum to map this)</span>
<span class="sd">            type: chain_of_thought          # The type of prompt to use</span>
<span class="sd">                                            # (predict, chain_of_thought)</span>
<span class="sd">            metric: rating                  # The type of metric to use</span>
<span class="sd">                                            # (rating, category)</span>
<span class="sd">            load_from_mlflow: false         # Whether to load the prompt</span>
<span class="sd">                                            # from an MLFlow URI</span>
<span class="sd">            model_uri: null                 # The tracking URI for MLflow</span>
<span class="sd">            model_name: null                # The name of the model in MLflow</span>
<span class="sd">            model_version: null             # The version of the model in MLflow</span>
<span class="sd">            prompt_metric: true             # Whether another prompt is used</span>
<span class="sd">                                            # to calculate the metric</span>
<span class="sd">                                            # (in which case we must load that prompt)</span>

<span class="sd">        prompt_metric:</span>
<span class="sd">            prompt: doc_quality             # The prompt to use to calculate the metric</span>
<span class="sd">            class: DocQualityPrompt         # The class of the prompt to use</span>
<span class="sd">                                            # to calculate the metric</span>
<span class="sd">            type: predict                   # The type of prompt to use</span>
<span class="sd">                                            # to calculate the metric</span>
<span class="sd">            metric: rating                  # The metric to use to calculate the metric</span>
<span class="sd">            load_from_mlflow: false         # Whether to load the prompt</span>
<span class="sd">                                            # from an MLFlow URI</span>
<span class="sd">            model_uri: null                 # The tracking URI for MLflow</span>
<span class="sd">            model_name: null                # The name of the model in MLflow</span>
<span class="sd">            model_version: null             # The version of the model in MLflow</span>

<span class="sd">        module:</span>
<span class="sd">            retry: true                     # Whether to retry the generation</span>
<span class="sd">                                            # if the quality check fails</span>
<span class="sd">            retry_limit: 1                  # The maximum number of retries</span>
<span class="sd">            rating_threshold: 3             # The rating threshold for the quality check</span>
<span class="sd">            fill_empty_descriptions: true   # Whether to fill empty descriptions with</span>
<span class="sd">                                            # generated documentation</span>

<span class="sd">    :param yaml_path: Path to the YAML file.</span>
<span class="sd">    :type yaml_path: Union[str, Path]</span>
<span class="sd">    :return: A DocGeneratorModule object.</span>
<span class="sd">    :rtype: DocGeneratorModule</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">load_yaml_config</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">)[</span><span class="s2">&quot;module&quot;</span><span class="p">]</span>
    <span class="n">prompt</span> <span class="o">=</span> <span class="n">single_prompt_from_yaml</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">doc_generator_module_from_dict</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">prompt</span><span class="p">)</span></div>



<span class="c1">#######################</span>
<span class="c1"># Eval Methods        #</span>
<span class="c1">#######################</span>
<div class="viewcode-block" id="doc_generator_eval_from_yaml">
<a class="viewcode-back" href="../../source/graphdoc.html#graphdoc.doc_generator_eval_from_yaml">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">doc_generator_eval_from_yaml</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">DocGeneratorEvaluator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Load a doc generator evaluator from a YAML file.</span>

<span class="sd">    .. code-block:: yaml</span>
<span class="sd">        mlflow: </span>
<span class="sd">            mlflow_tracking_uri: !env MLFLOW_TRACKING_URI           # The tracking URI for MLflow</span>
<span class="sd">            mlflow_tracking_username: !env MLFLOW_TRACKING_USERNAME # The username for the mlflow tracking server</span>
<span class="sd">            mlflow_tracking_password: !env MLFLOW_TRACKING_PASSWORD # The password for the mlflow tracking server</span>
<span class="sd">    </span>
<span class="sd">        prompt:</span>
<span class="sd">            prompt: base_doc_gen                                  # Which prompt signature to use</span>
<span class="sd">            class: DocGeneratorPrompt                             # Must be a child of SinglePrompt (we will use an enum to map this)</span>
<span class="sd">            type: chain_of_thought                                # The type of prompt to use (predict, chain_of_thought)</span>
<span class="sd">            metric: rating                                        # The type of metric to use (rating, category)</span>
<span class="sd">            load_from_mlflow: false                               # Whether to load the prompt from an MLFlow URI</span>
<span class="sd">            model_uri: null                                       # The tracking URI for MLflow</span>
<span class="sd">            model_name: null                                      # The name of the model in MLflow</span>
<span class="sd">            model_version: null                                   # The version of the model in MLflow</span>
<span class="sd">            prompt_metric: true                                   # Whether another prompt is used to calculate the metric (in which case we must also load that prompt)</span>

<span class="sd">        prompt_metric:</span>
<span class="sd">            prompt: doc_quality                                   # The prompt to use to calculate the metric</span>
<span class="sd">            class: DocQualityPrompt                               # The class of the prompt to use to calculate the metric</span>
<span class="sd">            type: predict                                         # The type of prompt to use to calculate the metric</span>
<span class="sd">            metric: rating                                        # The metric to use to calculate the metric</span>
<span class="sd">            load_from_mlflow: false                               # Whether to load the prompt from an MLFlow URI</span>
<span class="sd">            model_uri: null                                       # The tracking URI for MLflow</span>
<span class="sd">            model_name: null                                      # The name of the model in MLflow</span>
<span class="sd">            model_version: null   </span>

<span class="sd">        module: </span>
<span class="sd">            retry: true                                           # Whether to retry the generation if the quality check fails</span>
<span class="sd">            retry_limit: 1                                        # The maximum number of retries</span>
<span class="sd">            rating_threshold: 3                                   # The rating threshold for the quality check</span>
<span class="sd">            fill_empty_descriptions: true                         # Whether to fill the empty descriptions in the schema</span>

<span class="sd">        eval:</span>
<span class="sd">            mlflow_tracking_uri: !env MLFLOW_TRACKING_URI         # The tracking URI for MLflow</span>
<span class="sd">            mlflow_experiment_name: doc_generator_eval            # The name of the experiment in MLflow</span>
<span class="sd">            generator_prediction_field: documented_schema         # The field in the generator prediction to use</span>
<span class="sd">            evaluator_prediction_field: rating                    # The field in the evaluator prediction to use</span>
<span class="sd">            readable_value: 25          </span>
<span class="sd">    </span>
<span class="sd">    :param yaml_path: Path to the YAML file.</span>
<span class="sd">    :type yaml_path: Union[str, Path]</span>
<span class="sd">    :return: A DocGeneratorEvaluator object.</span>
<span class="sd">    :rtype: DocGeneratorEvaluator</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># load the generator</span>
    <span class="n">generator</span> <span class="o">=</span> <span class="n">doc_generator_module_from_yaml</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">)</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">load_yaml_config</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">)</span>

    <span class="c1"># load the evaluator</span>
    <span class="n">metric_config</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;prompt_metric&quot;</span><span class="p">]</span>
    <span class="n">evaluator</span> <span class="o">=</span> <span class="n">single_prompt_from_dict</span><span class="p">(</span><span class="n">metric_config</span><span class="p">,</span> <span class="n">metric_config</span><span class="p">[</span><span class="s2">&quot;metric&quot;</span><span class="p">])</span>

    <span class="c1"># load the eval config</span>
    <span class="n">mdh</span> <span class="o">=</span> <span class="n">mlflow_data_helper_from_yaml</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">)</span>  <span class="c1"># noqa: F841</span>
    <span class="n">mlflow_tracking_uri</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;mlflow&quot;</span><span class="p">][</span><span class="s2">&quot;mlflow_tracking_uri&quot;</span><span class="p">]</span>
    <span class="n">mlflow_experiment_name</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;eval&quot;</span><span class="p">][</span><span class="s2">&quot;mlflow_experiment_name&quot;</span><span class="p">]</span>
    <span class="n">generator_prediction_field</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;eval&quot;</span><span class="p">][</span><span class="s2">&quot;generator_prediction_field&quot;</span><span class="p">]</span>
    <span class="n">evaluator_prediction_field</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;eval&quot;</span><span class="p">][</span><span class="s2">&quot;evaluator_prediction_field&quot;</span><span class="p">]</span>
    <span class="n">readable_value</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;eval&quot;</span><span class="p">][</span><span class="s2">&quot;readable_value&quot;</span><span class="p">]</span>

    <span class="c1"># load the evalset</span>
    <span class="n">evalset</span> <span class="o">=</span> <span class="n">trainset_from_yaml</span><span class="p">(</span><span class="n">yaml_path</span><span class="p">)</span>

    <span class="c1"># return the evaluator</span>
    <span class="k">return</span> <span class="n">DocGeneratorEvaluator</span><span class="p">(</span>
        <span class="n">generator</span><span class="o">=</span><span class="n">generator</span><span class="p">,</span>
        <span class="n">evaluator</span><span class="o">=</span><span class="n">evaluator</span><span class="p">,</span>
        <span class="n">evalset</span><span class="o">=</span><span class="n">evalset</span><span class="p">,</span>
        <span class="n">mlflow_tracking_uri</span><span class="o">=</span><span class="n">mlflow_tracking_uri</span><span class="p">,</span>
        <span class="n">mlflow_experiment_name</span><span class="o">=</span><span class="n">mlflow_experiment_name</span><span class="p">,</span>
        <span class="n">generator_prediction_field</span><span class="o">=</span><span class="n">generator_prediction_field</span><span class="p">,</span>
        <span class="n">evaluator_prediction_field</span><span class="o">=</span><span class="n">evaluator_prediction_field</span><span class="p">,</span>
        <span class="n">readable_value</span><span class="o">=</span><span class="n">readable_value</span><span class="p">,</span>
    <span class="p">)</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Semiotic Labs.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>